<!DOCTYPE HTML>
<html lang="en-US">

<head>
	<meta charset="UTF-8">
	<title></title>
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script src="./JsBarcode.all.min.js"></script>
	<script>
		const pageSize = 2;
		Number.prototype.pad = function (n) {
			return new Array(n).join('0').slice((n || 2) * -1) + this;
		}
		$(document).ready(function () {
			const orderIds = getParameterValues('orders');
			getData(orderIds);
		});

		function getParameterValues(param) {
			var url = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
			for (var i = 0; i < url.length; i++) {
				var urlparam = url[i].split('=');
				if (urlparam[0] === param) {
					return urlparam[1];
				}
			}
		}
		function getData(orderIds) {
			let apiBasePath;
			if (window.location.hostname === 'localhost') {
				apiBasePath = 'http://localhost:3001';
			} else {
				apiBasePath = 'http://52.208.209.4:443';
			}
			headers = { Authorization: getAccessToken() }
			const url = apiBasePath + '/v1/orders?orderIds=' + orderIds;
			$.ajax({ url, headers, success: renderOrders });
		}
		function renderOrders(data) {
			const orderHtml = prepareShippingAddressHtml(data);
			$("#orders_list").append(orderHtml);

			for (let i = 0; i < data.length; i++) {
				const orderId = data[i].orderId.pad(5);
				JsBarcode("#barcode" + i, orderId);
			}
		}
		function getAccessToken() {
			const name = 'userInfo';
			const nameLenPlus = (name.length + 1);
			const cookieValue = document.cookie
				.split(';')
				.map(c => c.trim())
				.filter(cookie => {
					return cookie.substring(0, nameLenPlus) === `${name}=`;
				})
				.map(cookie => {
					return cookie.substring(nameLenPlus);
				})[0] || "{}";
			let userInfo
			try {
				userInfo = JSON.parse(utilSerice.getCookie('userInfo'))
			} catch (e) {

			}
			if (userInfo && userInfo.accessToken) {
				return 'Bearer ' + userInfo.accessToken;
			}
			return '';
		}


		function prepareShippingAddressHtml(r) {
			orderHtml = '<div class="page_break">';
			const pageBreakHtml = '</div ><div class="page_break">';

			for (let i = 0; i < r.length; i++) {
				if (r[i] && r[i].shippingAddress) {
					const addressLines = r[i].shippingAddress.split(/from/i);

					orderHtml += '<div class="order_shipping_address"> <div>';

					for (let j = 0; j < addressLines.length; j++) {
						orderHtml += '<p>' + addressLines[j] + '</p>';
						if (j + 2 == addressLines.length && addressLines[j]) {
							orderHtml += '<p><b>From: </b>' + addressLines[1] + '</p>';
							j++;
						}

					}

					r[i].shippingAddress

					orderHtml += '</div>';
					orderHtml += '<div><img class="barcode_img" id="barcode' + i + '"/></div></div>';
					if (i && (i + 1) % pageSize == 0)
						orderHtml += '</div>' + pageBreakHtml;
				}
			}
			return orderHtml + '</div>';
		}
	</script>
	<style>
		.order_shipping_content {
			/* display: flex;
			width: 100%;
			flex-wrap: wrap; */
		}

		.barcode_img {
			width: 100px;
			height: 50px;
		}

		.order_shipping_address {
			min-height: 250px;
			border: 2px solid;
			border-radius: 5px;
			width: 80%;
			margin: 50px auto;
			padding: 10px;
			font-size: 24px;
		}



		.page_break {
			display: flex;
			width: 100%;
			flex-wrap: wrap;
			page-break-after: always;
		}
	</style>
</head>


<body>
	<div id="orders_list" class="order_shipping_content">
	</div>
</body>

</html>